{"id":"mondodb-056","title":"[REFACTOR] Comparison query operators","description":"Refactor:\n- Create operator registry pattern\n- Optimize SQL generation\n- Add query validation\n- Handle edge cases (null, undefined)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:17:28.956484-06:00","updated_at":"2026-01-04T11:58:26.705534-06:00","closed_at":"2026-01-04T11:58:26.705534-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-056","depends_on_id":"mondodb-i0r","type":"blocks","created_at":"2026-01-04T11:19:01.832935-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-0cr","title":"Compat tests: Edge cases (null, empty, nested, unicode)","description":"## Task\nCreate compatibility tests for critical edge cases.\n\n## Location\n`test/compatibility/edge-cases/edge-cases.compat.test.ts`\n\n## Null/Undefined Handling\n1. Insert document with null field\n2. Insert document with undefined field (stripped or kept?)\n3. Query for null field value\n4. Query for missing field\n5. $exists:true on null vs missing\n6. Update $set to null vs $unset\n7. Comparison with null ($gt, $lt)\n\n## Empty Values\n1. Empty string '' as field value\n2. Empty object {} as field value\n3. Empty array [] as field value\n4. Empty filter {} (match all)\n5. Empty update {} (what happens?)\n6. Empty projection {}\n\n## Nested Documents  \n1. Deeply nested documents (10+ levels)\n2. Dot notation in queries\n3. Dot notation in updates\n4. Array of objects queries\n5. $elemMatch on nested arrays\n6. Creating nested path with $set\n\n## Special Characters/Unicode\n1. Field names with unicode\n2. Field values with unicode\n3. Field names with special chars (allowed ones)\n4. Regex with unicode\n5. Sort with unicode (collation)\n\n## Array Semantics\n1. Array equality (exact match vs element match)\n2. Query scalar matches array element\n3. Query array matches array (must be exact)\n4. Nested arrays\n\n## Type Coercion\n1. String ObjectId vs ObjectId type\n2. Number string '123' vs number 123\n3. Boolean vs truthy/falsy\n\n## Boundary Conditions\n1. Max document size approaching 16MB\n2. Max field name length\n3. Max nesting depth\n4. Max array length","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:45:06.89949-06:00","updated_at":"2026-01-04T13:45:06.89949-06:00","dependencies":[{"issue_id":"mondodb-0cr","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:51:33.707757-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-0cr","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:51:39.004239-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-0cr","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:51:44.306083-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-0f6","title":"[REFACTOR] capnweb RPC server","description":"Refactor:\n- Request batching optimization\n- Promise pipelining support\n- Error serialization\n- Resource cleanup on disconnect","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:30:30.354345-06:00","updated_at":"2026-01-04T12:00:42.580803-06:00","closed_at":"2026-01-04T12:00:42.580803-06:00","close_reason":"Closed"}
{"id":"mondodb-0hy","title":"Compat tests: Element query operators","description":"## Task\nCreate compatibility tests for element query operators.\n\n## Location\n`test/compatibility/query-operators/element.compat.test.ts`\n\n## Operators\n- $exists - Field exists\n- $type - Field type check\n\n## Test Cases\n\n### $exists\n1. $exists:true matches documents with field\n2. $exists:false matches documents without field\n3. $exists:true on null field (TRICKY: field exists but is null)\n4. $exists:true on undefined field\n5. $exists on nested field\n6. $exists on array element\n\n### $type\n1. $type:'string' matches strings\n2. $type:'number' matches numbers (int and double)\n3. $type:'bool' matches booleans\n4. $type:'object' matches embedded documents\n5. $type:'array' matches arrays\n6. $type:'null' matches null values\n7. $type:'objectId' matches ObjectIds\n8. $type:'date' matches Date objects\n9. $type with number codes (legacy)\n10. $type with array of types\n\n## Critical Edge Cases\n```javascript\n// This is the most important edge case:\n{ field: null }  // $exists:true → TRUE (field exists, value is null)\n{ }              // $exists:true → FALSE (field missing)\n{ field: undefined } // Behavior may vary!\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:42:06.632292-06:00","updated_at":"2026-01-04T13:42:06.632292-06:00","dependencies":[{"issue_id":"mondodb-0hy","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:49:01.846045-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-0hy","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:49:07.135113-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-0hy","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:49:12.435264-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-0js","title":"[EPIC] Storage Layer - Durable Object SQLite","description":"Implement the core Durable Object with SQLite storage for document persistence. This is the foundation of mondodb.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-04T11:13:40.097233-06:00","updated_at":"2026-01-04T12:07:04.551914-06:00","closed_at":"2026-01-04T12:07:04.551914-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-0js","depends_on_id":"mondodb-ax4","type":"blocks","created_at":"2026-01-04T11:39:30.714312-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-0rr","title":"[GREEN] Element and array query operators","description":"Implement:\n- translateElement() for $exists, $type\n- translateArray() for $all, $elemMatch, $size\n- Use json_each for array iteration\n- Type mapping MongoDB→SQLite","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:18:00.238527-06:00","updated_at":"2026-01-04T11:58:26.708184-06:00","closed_at":"2026-01-04T11:58:26.708184-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-0rr","depends_on_id":"mondodb-b2f","type":"blocks","created_at":"2026-01-04T11:22:13.351563-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-0ve","title":"[RED] MongoClient connection","description":"Write failing tests for:\n- new MongoClient(uri, options) constructor\n- client.connect() establishes connection\n- client.close() terminates connection\n- client.db(name) returns MongoDatabase\n- URI parsing for database name\n- Connection options support","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:24:18.732324-06:00","updated_at":"2026-01-04T12:01:28.032069-06:00","closed_at":"2026-01-04T12:01:28.032069-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-0ve","depends_on_id":"mondodb-e6p","type":"blocks","created_at":"2026-01-04T11:41:31.002068-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-1ah","title":"[EPIC] Aggregation Pipeline","description":"Implement MongoDB aggregation pipeline stages: $match, $project, $group, $sort, $limit, $skip, $lookup, $unwind.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T11:14:12.754312-06:00","updated_at":"2026-01-04T12:07:04.555462-06:00","closed_at":"2026-01-04T12:07:04.555462-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-1ah","depends_on_id":"mondodb-t04","type":"blocks","created_at":"2026-01-04T11:40:07.295433-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-1g9","title":"[RED] Logical query operators","description":"Write failing tests for:\n- $and → (cond1) AND (cond2)\n- $or → (cond1) OR (cond2)\n- $not → NOT (condition)\n- $nor → NOT (cond1) AND NOT (cond2)\n- Nested logical operators\n- Empty conditions","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:17:35.754375-06:00","updated_at":"2026-01-04T11:58:26.706011-06:00","closed_at":"2026-01-04T11:58:26.706011-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-1g9","depends_on_id":"mondodb-056","type":"blocks","created_at":"2026-01-04T11:19:07.058713-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-1sw","title":"[REFACTOR] capnweb RPC client","description":"Refactor:\n- Auto-reconnection logic\n- Request deduplication\n- Connection health monitoring\n- TypeScript type inference","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:30:56.449101-06:00","updated_at":"2026-01-04T12:00:42.582094-06:00","closed_at":"2026-01-04T12:00:42.582094-06:00","close_reason":"Closed"}
{"id":"mondodb-28p","title":"[RED] capnweb RPC server","description":"Write failing tests for:\n- Worker exports RpcTarget for MongoDB API\n- newWorkersRpcResponse handles requests\n- HTTP batch protocol support\n- WebSocket streaming support\n- Method dispatch to Durable Object\n- Stub management for cursors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:30:17.218874-06:00","updated_at":"2026-01-04T12:00:42.579583-06:00","closed_at":"2026-01-04T12:00:42.579583-06:00","close_reason":"Closed"}
{"id":"mondodb-2fh","title":"Text Search with $text operator","description":"Implement text search functionality:\n- createIndex({field: 'text'}) for text indexes\n- $text query operator with $search, $language, $caseSensitive\n- $meta textScore projection\n- Use SQLite FTS5 for full-text search","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-04T13:09:33.440614-06:00","updated_at":"2026-01-04T13:33:23.522938-06:00","closed_at":"2026-01-04T13:33:23.522938-06:00","close_reason":"Closed"}
{"id":"mondodb-2ht","title":"[REFACTOR] Array update operators","description":"Refactor:\n- Optimize array operations with CTE\n- Add position modifiers support\n- Implement $sort modifier\n- Handle large array edge cases","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:23:49.929317-06:00","updated_at":"2026-01-04T11:59:48.990401-06:00","closed_at":"2026-01-04T11:59:48.990401-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-2ht","depends_on_id":"mondodb-z2s","type":"blocks","created_at":"2026-01-04T11:41:25.661922-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-2jm","title":"[GREEN] Document CRUD operations in SQLite","description":"Implement:\n- INSERT with json() for document storage\n- ObjectId generation for _id\n- SELECT with json_extract for queries\n- UPDATE with json_set/json_replace\n- DELETE with WHERE clause\n- Proper parameterized queries","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:23.147309-06:00","updated_at":"2026-01-04T12:07:04.550989-06:00","closed_at":"2026-01-04T12:07:04.550989-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-2jm","depends_on_id":"mondodb-omw","type":"blocks","created_at":"2026-01-04T11:16:24.16891-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-2r5","title":"[REFACTOR] MongoCursor iteration","description":"Refactor:\n- Streaming support for large results\n- Memory-efficient iteration\n- Cursor batching optimization\n- Timeout handling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:28:29.481112-06:00","updated_at":"2026-01-04T11:58:42.736842-06:00","closed_at":"2026-01-04T11:58:42.736842-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-2r5","depends_on_id":"mondodb-o6j","type":"blocks","created_at":"2026-01-04T11:42:29.96775-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-3e0","title":"[EPIC] Query Translation Engine","description":"Translate MongoDB query operators to SQL WHERE clauses. Supports comparison, logical, and element operators.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T11:13:46.545664-06:00","updated_at":"2026-01-04T12:07:04.554745-06:00","closed_at":"2026-01-04T12:07:04.554745-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-3e0","depends_on_id":"mondodb-86g","type":"blocks","created_at":"2026-01-04T11:39:35.936499-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-3kh","title":"Create TestProvider interface and types","description":"## Task\nCreate the unified provider interface that both MongoDB and mondodb will implement.\n\n## Location\n`test/compatibility/providers/types.ts`\n\n## Interface Design\n```typescript\nexport interface TestProvider {\n  readonly name: 'mondodb' | 'mongodb'\n  connect(): Promise\u003cvoid\u003e\n  disconnect(): Promise\u003cvoid\u003e\n  database(name: string): TestDatabase\n  dropDatabase(name: string): Promise\u003cvoid\u003e\n}\n\nexport interface TestDatabase {\n  readonly databaseName: string\n  collection\u003cT = Document\u003e(name: string): TestCollection\u003cT\u003e\n  dropCollection(name: string): Promise\u003cvoid\u003e\n}\n\nexport interface TestCollection\u003cT = Document\u003e {\n  readonly collectionName: string\n  // CRUD\n  insertOne(doc: T, options?: InsertOneOptions): Promise\u003cInsertOneResult\u003e\n  insertMany(docs: T[], options?: InsertManyOptions): Promise\u003cInsertManyResult\u003e\n  findOne(filter: Filter\u003cT\u003e, options?: FindOptions): Promise\u003cT | null\u003e\n  find(filter: Filter\u003cT\u003e, options?: FindOptions): TestCursor\u003cT\u003e\n  updateOne(filter: Filter\u003cT\u003e, update: UpdateFilter\u003cT\u003e, options?: UpdateOptions): Promise\u003cUpdateResult\u003e\n  updateMany(filter: Filter\u003cT\u003e, update: UpdateFilter\u003cT\u003e, options?: UpdateOptions): Promise\u003cUpdateResult\u003e\n  deleteOne(filter: Filter\u003cT\u003e, options?: DeleteOptions): Promise\u003cDeleteResult\u003e\n  deleteMany(filter: Filter\u003cT\u003e, options?: DeleteOptions): Promise\u003cDeleteResult\u003e\n  replaceOne(filter: Filter\u003cT\u003e, replacement: T, options?: ReplaceOptions): Promise\u003cUpdateResult\u003e\n  // FindAndModify\n  findOneAndUpdate(filter: Filter\u003cT\u003e, update: UpdateFilter\u003cT\u003e, options?: FindOneAndUpdateOptions): Promise\u003cT | null\u003e\n  findOneAndDelete(filter: Filter\u003cT\u003e, options?: FindOneAndDeleteOptions): Promise\u003cT | null\u003e\n  findOneAndReplace(filter: Filter\u003cT\u003e, replacement: T, options?: FindOneAndReplaceOptions): Promise\u003cT | null\u003e\n  // Other\n  countDocuments(filter?: Filter\u003cT\u003e): Promise\u003cnumber\u003e\n  aggregate\u003cR = Document\u003e(pipeline: Document[]): TestCursor\u003cR\u003e\n  bulkWrite(ops: BulkWriteOperation\u003cT\u003e[], options?: BulkWriteOptions): Promise\u003cBulkWriteResult\u003e\n  drop(): Promise\u003cvoid\u003e\n}\n\nexport interface TestCursor\u003cT\u003e {\n  toArray(): Promise\u003cT[]\u003e\n  next(): Promise\u003cT | null\u003e\n  hasNext(): Promise\u003cboolean\u003e\n  limit(n: number): TestCursor\u003cT\u003e\n  skip(n: number): TestCursor\u003cT\u003e\n  sort(spec: SortSpec): TestCursor\u003cT\u003e\n  project(spec: ProjectionSpec): TestCursor\u003cT\u003e\n}\n```\n\n## TDD\nTest that types compile correctly and interfaces are exported.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T13:37:53.1476-06:00","updated_at":"2026-01-04T13:53:58.824606-06:00","closed_at":"2026-01-04T13:53:58.824606-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-3kh","depends_on_id":"mondodb-8qj","type":"blocks","created_at":"2026-01-04T13:45:33.531393-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-3ks","title":"FunctionExecutor core module","description":"## Description\nCore class for executing user functions in isolated V8 workers.\n\n## TDD Test Cases (RED)\n```typescript\ndescribe('FunctionExecutor', () =\u003e {\n  describe('capability detection', () =\u003e {\n    it('throws helpful error when LOADER binding missing')\n    it('initializes successfully when LOADER present')\n  })\n  \n  describe('single execution', () =\u003e {\n    it('executes simple arrow function')\n    it('executes function declaration')\n    it('passes arguments correctly')\n    it('returns computed value')\n    it('handles errors gracefully')\n    it('enforces timeout')\n  })\n  \n  describe('batch execution', () =\u003e {\n    it('processes multiple arg sets in single isolate')\n    it('returns results in same order as inputs')\n    it('handles partial failures')\n  })\n  \n  describe('security', () =\u003e {\n    it('blocks fetch() calls (globalOutbound: null)')\n    it('has no access to parent env bindings')\n    it('cannot access global state between calls')\n  })\n})\n```\n\n## Implementation\n- src/executor/function-executor.ts\n- Types in src/types/function.ts\n- Extend Env interface with optional LOADER\n\n## API\n```typescript\nclass FunctionExecutor {\n  constructor(env: Env)\n  \n  async execute(body: string, args: unknown[], timeout?: number): Promise\u003cunknown\u003e\n  async executeBatch(body: string, argsArray: unknown[][], timeout?: number): Promise\u003cunknown[]\u003e\n}\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T13:31:05.988451-06:00","updated_at":"2026-01-04T13:49:21.034014-06:00","closed_at":"2026-01-04T13:49:21.034014-06:00","close_reason":"Implemented with 73 passing tests","dependencies":[{"issue_id":"mondodb-3ks","depends_on_id":"mondodb-cnm","type":"blocks","created_at":"2026-01-04T13:32:33.628103-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-3wr","title":"Compat tests: Evaluation query operators","description":"## Task\nCreate compatibility tests for evaluation query operators.\n\n## Location\n`test/compatibility/query-operators/evaluation.compat.test.ts`\n\n## Operators\n- $regex - Regular expression match\n- $expr - Aggregation expressions in query\n- $mod - Modulo operation\n- $text - Text search (if supported)\n\n## Test Cases\n\n### $regex\n1. Basic regex match\n2. Case-insensitive with $options:'i'\n3. Multiline with $options:'m'\n4. Anchors ^ and $\n5. $regex with string pattern\n6. $regex with RegExp object\n7. $regex on non-string field\n8. $not with $regex\n\n### $expr\n1. Field comparison $expr:{$gt:['$a','$b']}\n2. Arithmetic in expression\n3. $expr with $and/$or\n4. Access nested fields in $expr\n\n### $mod\n1. $mod:[divisor, remainder]\n2. $mod on non-numeric field\n3. $mod with negative numbers\n4. $mod with floats\n\n## Edge Cases\n- Regex special characters escaping\n- Unicode in regex\n- Empty string regex\n- Very long regex (performance)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:42:43.762379-06:00","updated_at":"2026-01-04T13:42:43.762379-06:00","dependencies":[{"issue_id":"mondodb-3wr","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:49:33.610479-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-3wr","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:49:38.907868-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-3wr","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:49:44.1978-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-4jc","title":"Expression translator $function support","description":"## Description\nAdd $function operator to expression-translator.ts\n\n## TDD Test Cases (RED)\n```typescript\ndescribe('translateExpression - $function', () =\u003e {\n  it('parses $function with body, args, lang')\n  it('extracts field references from args')\n  it('validates lang is \"js\"')\n  it('throws on missing body')\n  it('throws on missing args')\n  it('returns FunctionExpression marker for deferred execution')\n})\n\ndescribe('$function arg resolution', () =\u003e {\n  it('resolves $fieldName to document values')\n  it('handles nested field paths $user.name')\n  it('passes literal values unchanged')\n  it('handles mixed field refs and literals')\n})\n```\n\n## Implementation\n```typescript\n// New marker type for deferred function execution\ninterface FunctionExpression {\n  __type: 'function'\n  body: string\n  argPaths: string[]  // Field paths to extract\n  literals: Map\u003cnumber, unknown\u003e  // Position → literal value\n}\n\n// In translateExpression\nif (operator === '$function') {\n  return createFunctionMarker(expr.$function)\n}\n```\n\n## Files\n- src/translator/stages/expression-translator.ts\n- src/types/function.ts","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T13:31:36.849168-06:00","updated_at":"2026-01-04T13:49:21.034836-06:00","closed_at":"2026-01-04T13:49:21.034836-06:00","close_reason":"Implemented with 73 passing tests","dependencies":[{"issue_id":"mondodb-4jc","depends_on_id":"mondodb-cnm","type":"blocks","created_at":"2026-01-04T13:32:38.90438-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-4l5","title":"[RED] MongoCursor iteration","description":"Write failing tests for:\n- cursor.toArray() returns all documents\n- cursor.next() returns next document\n- cursor.hasNext() checks for more\n- cursor.forEach(callback) iterates\n- cursor.map(fn) transforms\n- cursor.close() releases resources\n- Symbol.asyncIterator support","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:26:48.844688-06:00","updated_at":"2026-01-04T11:58:42.735482-06:00","closed_at":"2026-01-04T11:58:42.735482-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-4l5","depends_on_id":"mondodb-b4u","type":"blocks","created_at":"2026-01-04T11:42:19.225609-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-4n6","title":"Transaction Support","description":"Implement multi-document transactions:\n- session.startTransaction()\n- session.commitTransaction() / abortTransaction()\n- Map to SQLite BEGIN/COMMIT/ROLLBACK\n- Transaction isolation levels\n- Timeout and retry logic","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T13:09:33.402831-06:00","updated_at":"2026-01-04T13:33:23.520901-06:00","closed_at":"2026-01-04T13:33:23.520901-06:00","close_reason":"Closed"}
{"id":"mondodb-4r9","title":"Compat tests: Error codes and messages","description":"## Task\nCreate compatibility tests for error behavior.\n\n## Location\n`test/compatibility/errors/errors.compat.test.ts`\n\n## Error Codes to Verify\n\n### Duplicate Key (11000)\n1. insertOne with duplicate _id\n2. insertMany with duplicate in batch\n3. updateOne with upsert causing duplicate\n4. Error message contains key info\n\n### Invalid Operations\n1. Invalid query operator (unknown $xyz)\n2. Invalid update operator\n3. Update with both operators and replacement\n4. Invalid aggregation stage\n5. Invalid BSON type\n\n### Type Errors\n1. $inc on non-numeric field\n2. $push on non-array field\n3. Invalid ObjectId string\n\n### Validation Errors\n1. Document too large (16MB limit)\n2. Invalid field name (contains $)\n3. Invalid field name (contains .)\n4. Nested depth limit\n\n## Test Pattern\n```typescript\nit('duplicate key throws error code 11000', async () =\u003e {\n  const doc = { _id: new ObjectId() }\n  \n  await mongoCol.insertOne(doc)\n  await mondoCol.insertOne({ ...doc })\n  \n  let mongoError: any, mondoError: any\n  \n  try {\n    await mongoCol.insertOne(doc)\n  } catch (e) { mongoError = e }\n  \n  try {\n    await mondoCol.insertOne({ ...doc })  \n  } catch (e) { mondoError = e }\n  \n  expect(mongoError.code).toBe(11000)\n  expect(mondoError.code).toBe(11000)\n  // May also verify error message pattern\n})\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:44:45.447414-06:00","updated_at":"2026-01-04T13:44:45.447414-06:00","dependencies":[{"issue_id":"mondodb-4r9","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:51:17.819338-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-4r9","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:51:23.109065-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-4r9","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:51:28.407256-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-5c7","title":"Implement MondoDBProvider (mondodb client wrapper)","description":"## Task\nImplement TestProvider for mondodb, wrapping our MongoClient.\n\n## Location\n`test/compatibility/providers/mondodb-provider.ts`\n\n## Implementation\n```typescript\nimport { MongoClient } from '../../../src/client/mongo-client'\nimport { MongoDatabase } from '../../../src/client/mongo-database'  \nimport { MongoCollection } from '../../../src/client/mongo-collection'\nimport { TestProvider, TestDatabase, TestCollection, TestCursor } from './types'\n\nexport class MondoDBProvider implements TestProvider {\n  readonly name = 'mondodb' as const\n  private client!: MongoClient\n  private databases: Map\u003cstring, MondoDBDatabase\u003e = new Map()\n  \n  async connect(): Promise\u003cvoid\u003e {\n    this.client = new MongoClient('mondodb://localhost:27017')\n    await this.client.connect()\n  }\n  \n  async disconnect(): Promise\u003cvoid\u003e {\n    await this.client?.close()\n    this.databases.clear()\n  }\n  \n  database(name: string): TestDatabase {\n    if (!this.databases.has(name)) {\n      this.databases.set(name, new MondoDBDatabase(this.client.db(name)))\n    }\n    return this.databases.get(name)!\n  }\n  \n  async dropDatabase(name: string): Promise\u003cvoid\u003e {\n    const db = this.database(name)\n    // Drop all collections in the database\n  }\n}\n\nclass MondoDBDatabase implements TestDatabase {\n  constructor(private db: MongoDatabase) {}\n  \n  get databaseName(): string { return this.db.databaseName }\n  \n  collection\u003cT\u003e(name: string): TestCollection\u003cT\u003e {\n    return new MondoDBCollection(this.db.collection(name))\n  }\n}\n\n// Wrap mondodb Collection to match TestCollection interface  \nclass MondoDBCollection\u003cT\u003e implements TestCollection\u003cT\u003e {\n  // Direct passthrough to mondodb methods\n}\n\n// Wrap mondodb Cursor to match TestCursor interface\nclass MondoDBCursor\u003cT\u003e implements TestCursor\u003cT\u003e {\n  // Wrap FindCursor methods\n}\n```\n\n## TDD Tests\n1. Can connect with mondodb:// URI\n2. Can perform basic CRUD operations\n3. Can disconnect cleanly\n4. Multiple databases work independently","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-04T13:38:30.770791-06:00","updated_at":"2026-01-04T13:38:30.770791-06:00","dependencies":[{"issue_id":"mondodb-5c7","depends_on_id":"mondodb-3kh","type":"blocks","created_at":"2026-01-04T13:45:44.124977-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-5tq","title":"[RED] MongoDatabase operations","description":"Write failing tests for:\n- db.collection(name) returns MongoCollection\n- db.listCollections() returns cursor\n- db.createCollection(name, options)\n- db.dropCollection(name)\n- db.command() executes database command","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:25:37.144042-06:00","updated_at":"2026-01-04T12:01:28.033767-06:00","closed_at":"2026-01-04T12:01:28.033767-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-5tq","depends_on_id":"mondodb-wic","type":"blocks","created_at":"2026-01-04T11:41:47.050408-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-65u","title":"[GREEN] MongoCollection CRUD","description":"Implement MongoCollection class:\n- insertOne/Many with ObjectId generation\n- find/findOne using QueryTranslator\n- updateOne/Many using UpdateTranslator\n- deleteOne/Many with filter translation\n- Return proper result objects (InsertOneResult, etc.)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:26:17.075226-06:00","updated_at":"2026-01-04T12:01:28.035369-06:00","closed_at":"2026-01-04T12:01:28.035369-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-65u","depends_on_id":"mondodb-byh","type":"blocks","created_at":"2026-01-04T11:42:08.490917-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-67o","title":"[RED] Comparison query operators","description":"Write failing tests for translating:\n- $eq → json_extract(data, path) = ?\n- $ne → json_extract(data, path) != ?\n- $gt, $gte, $lt, $lte → comparison operators\n- $in → IN (?, ?, ?)\n- $nin → NOT IN (?, ?, ?)\n- Nested field paths (a.b.c)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:17:16.770085-06:00","updated_at":"2026-01-04T11:58:26.704205-06:00","closed_at":"2026-01-04T11:58:26.704205-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-67o","depends_on_id":"mondodb-3e0","type":"blocks","created_at":"2026-01-04T11:18:51.39017-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-6md","title":"Compat tests: findOne and find","description":"## Task\nCreate compatibility tests for find operations.\n\n## Location\n`test/compatibility/crud/find.compat.test.ts`\n\n## Test Cases\n\n### findOne\n1. Find existing document - returns document\n2. Find non-existent - returns null\n3. Empty filter {} - returns any document\n4. Filter by _id (ObjectId)\n5. Filter by _id (string) - type coercion\n6. Filter with projection (inclusion)\n7. Filter with projection (exclusion)\n8. Projection excludes _id\n9. Nested field filter (dot notation)\n10. Array element filter\n\n### find (cursor)\n1. Returns all matching documents\n2. Empty result set - empty array\n3. Cursor.toArray() returns correct documents\n4. Cursor.limit() restricts results\n5. Cursor.skip() offsets results\n6. Cursor.sort() orders results (ascending)\n7. Cursor.sort() orders results (descending)\n8. Cursor.sort() with multiple fields\n9. Chaining limit().skip().sort()\n10. Cursor.next() iteration\n11. Cursor.hasNext() correctness\n12. Projection via cursor\n13. Large result set handling\n\n### Edge Cases\n1. Find with null field value\n2. Find where field doesn't exist\n3. Sort with null values (ordering)\n4. Sort with mixed types\n5. Empty projection object behavior","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:40:01.374078-06:00","updated_at":"2026-01-04T13:40:01.374078-06:00","dependencies":[{"issue_id":"mondodb-6md","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:47:00.734808-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-6md","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:47:06.043734-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-6md","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:47:11.342275-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-79o","title":"[EPIC] Local Development - Miniflare Integration","description":"Support local filesystem storage via Miniflare for testing and development.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T11:14:25.054412-06:00","updated_at":"2026-01-04T12:07:04.552807-06:00","closed_at":"2026-01-04T12:07:04.552807-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-79o","depends_on_id":"mondodb-86g","type":"blocks","created_at":"2026-01-04T11:40:02.066706-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-7io","title":"[GREEN] Logical query operators","description":"Implement:\n- translateLogical() for $and, $or, $not, $nor\n- Recursive query translation\n- Proper parentheses grouping\n- Short-circuit optimization\n- Handle implicit $and for multiple conditions","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:17:41.818496-06:00","updated_at":"2026-01-04T11:58:26.706468-06:00","closed_at":"2026-01-04T11:58:26.706468-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-7io","depends_on_id":"mondodb-1g9","type":"blocks","created_at":"2026-01-04T11:19:12.284927-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-832","title":"Geospatial Queries","description":"Implement geospatial query support:\n- 2dsphere index type\n- $geoWithin, $geoIntersects, $near, $nearSphere operators\n- GeoJSON support (Point, Polygon, LineString)\n- Use SQLite R-tree extension","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-04T13:09:48.33847-06:00","updated_at":"2026-01-04T13:33:23.523295-06:00","closed_at":"2026-01-04T13:33:23.523295-06:00","close_reason":"Closed"}
{"id":"mondodb-83k","title":"[RED] ObjectId generation","description":"Write failing tests for:\n- ObjectId generates 24 hex char string\n- ObjectId is unique across calls\n- ObjectId includes timestamp component\n- ObjectId can be created from string\n- ObjectId comparison works","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:35.485628-06:00","updated_at":"2026-01-04T11:54:25.867488-06:00","closed_at":"2026-01-04T11:54:25.867488-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-83k","depends_on_id":"mondodb-0js","type":"blocks","created_at":"2026-01-04T11:16:34.627304-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-86g","title":"[REFACTOR] Document CRUD operations in SQLite","description":"Refactor:\n- Optimize batch operations\n- Add query plan analysis\n- Implement write coalescing\n- Add error handling and validation","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:29.4073-06:00","updated_at":"2026-01-04T12:07:04.550168-06:00","closed_at":"2026-01-04T12:07:04.550168-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-86g","depends_on_id":"mondodb-2jm","type":"blocks","created_at":"2026-01-04T11:16:29.393213-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-8be","title":"Compat tests: Aggregation pipeline","description":"## Task\nCreate compatibility tests for aggregation pipeline stages.\n\n## Location\n`test/compatibility/aggregation/pipeline.compat.test.ts`\n\n## Stages to Test\n- $match - Filter documents\n- $project - Reshape documents\n- $group - Group and aggregate\n- $sort - Sort documents\n- $limit/$skip - Pagination\n- $unwind - Deconstruct arrays\n- $lookup - Join collections\n- $count - Count documents\n\n## Test Cases\n\n### $match\n1. Simple filter\n2. Complex filter with operators\n3. $match at start vs middle of pipeline\n4. $match with $expr\n\n### $project\n1. Include fields (1)\n2. Exclude fields (0)\n3. Rename fields ('$fieldName')\n4. Computed fields with expressions\n5. $project _id exclusion\n\n### $group\n1. Group by single field\n2. Group by null (all docs)\n3. $sum accumulator\n4. $avg accumulator\n5. $min/$max accumulators\n6. $push accumulator\n7. $addToSet accumulator\n8. $first/$last accumulators\n9. Multiple accumulators\n\n### $sort\n1. Ascending/descending\n2. Multiple sort keys\n3. Sort by computed field\n\n### $lookup\n1. Basic left outer join\n2. localField/foreignField matching\n3. Empty matches (no results)\n4. as field naming\n\n### $unwind\n1. Basic array unwind\n2. preserveNullAndEmptyArrays:true\n3. includeArrayIndex option\n\n## Cursor Behavior\n- aggregate().toArray()\n- aggregate().next()\n- aggregate().explain() if supported","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:43:49.998117-06:00","updated_at":"2026-01-04T13:43:49.998117-06:00","dependencies":[{"issue_id":"mondodb-8be","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:50:30.207642-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-8be","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:50:35.511125-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-8be","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:50:40.800375-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-8i3","title":"Compat tests: updateOne and updateMany","description":"## Task\nCreate compatibility tests for update operations.\n\n## Location\n`test/compatibility/crud/update.compat.test.ts`\n\n## Test Cases\n\n### updateOne\n1. Basic $set update - verify UpdateResult structure\n2. matchedCount when document exists\n3. matchedCount when document doesn't exist\n4. modifiedCount when change made\n5. modifiedCount when no actual change (same value)\n6. upsert:true creates new document\n7. upsertedId returned on upsert\n8. upsertedCount on upsert\n9. Filter matches multiple - only updates first\n10. Update with multiple operators\n\n### updateMany  \n1. Updates all matching documents\n2. matchedCount equals number of matches\n3. modifiedCount equals number of modifications\n4. No matches - zero counts\n5. upsert:true with no matches\n6. Empty filter {} updates all documents\n\n### Edge Cases\n1. Update non-existent field\n2. Update nested field (dot notation)\n3. Update array element by index\n4. $set to null\n5. $unset behavior\n6. Concurrent update atomicity\n\n### Return Value Structure\n```typescript\ninterface UpdateResult {\n  acknowledged: boolean\n  matchedCount: number\n  modifiedCount: number\n  upsertedId?: ObjectId\n  upsertedCount?: number\n}\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:40:18.972576-06:00","updated_at":"2026-01-04T13:40:18.972576-06:00","dependencies":[{"issue_id":"mondodb-8i3","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:47:16.631919-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-8i3","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:47:21.931907-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-8i3","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:47:27.229209-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-8m3","title":"[RED] Workers RPC service binding","description":"Write failing tests for:\n- WorkerEntrypoint exposes MongoDB methods\n- Service binding configuration in wrangler.toml\n- Direct method calls without HTTP\n- Durable Object stub passing works\n- Cross-worker communication","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:31:02.501427-06:00","updated_at":"2026-01-04T12:00:42.58256-06:00","closed_at":"2026-01-04T12:00:42.58256-06:00","close_reason":"Closed"}
{"id":"mondodb-8qj","title":"Add mongodb and mongodb-memory-server dependencies","description":"## Task\nAdd npm dependencies required for compatibility testing:\n\n```bash\nnpm install --save-dev mongodb mongodb-memory-server\n```\n\n## Acceptance Criteria\n- [ ] mongodb ^6.0.0 added to devDependencies\n- [ ] mongodb-memory-server ^9.0.0 added to devDependencies\n- [ ] npm install succeeds\n- [ ] TypeScript types work correctly\n\n## TDD\nWrite a simple test that imports both packages and verifies they load:\n```typescript\nimport { MongoClient } from 'mongodb'\nimport { MongoMemoryServer } from 'mongodb-memory-server'\nexpect(MongoClient).toBeDefined()\nexpect(MongoMemoryServer).toBeDefined()\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T13:37:33.084356-06:00","updated_at":"2026-01-04T13:55:07.172693-06:00","closed_at":"2026-01-04T13:55:07.172693-06:00","close_reason":"Closed"}
{"id":"mondodb-8ra","title":"[GREEN] capnweb RPC server","description":"Implement:\n- MondoRpcTarget extending RpcTarget\n- Route requests to Durable Object stubs\n- Expose connect(), db(), collection() methods\n- Handle cursor stubs with proper disposal\n- Workers-specific response handler","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:30:23.595096-06:00","updated_at":"2026-01-04T12:00:42.580336-06:00","closed_at":"2026-01-04T12:00:42.580336-06:00","close_reason":"Closed"}
{"id":"mondodb-8vr","title":"Compat tests: Array update operators","description":"## Task\nCreate compatibility tests for array update operators.\n\n## Location\n`test/compatibility/update-operators/array.compat.test.ts`\n\n## Operators\n- $push - Add element(s) to array\n- $pull - Remove elements matching condition\n- $pop - Remove first/last element\n- $addToSet - Add unique element\n- $pullAll - Remove all matching values\n\n## Test Cases\n\n### $push\n1. Push single element\n2. Push to non-existent field (creates array)\n3. Push with $each for multiple elements\n4. Push with $position\n5. Push with $slice (limit array size)\n6. Push with $sort\n7. Combined $each + $slice + $sort\n\n### $pull\n1. Pull exact value\n2. Pull with query condition {$gt: 5}\n3. Pull from nested array\n4. Pull object from array (deep equality)\n5. Pull non-existent value (no error)\n\n### $pop\n1. $pop:1 removes last element\n2. $pop:-1 removes first element\n3. $pop on empty array\n4. $pop on non-array (error?)\n\n### $addToSet\n1. Add new unique element\n2. Don't add duplicate\n3. $addToSet with $each\n4. Object equality for deduplication\n5. $addToSet to non-existent field\n\n### $pullAll\n1. Remove multiple specific values\n2. Order doesn't matter\n3. Remove duplicates in one operation\n\n## Critical Edge Cases\n```javascript\n// $push with $each + $slice + $sort together\n{$push: {scores: {$each: [89, 92], $slice: -5, $sort: -1}}}\n// Adds elements, sorts descending, keeps last 5\n\n// Object equality in $addToSet and $pull\n// {a:1, b:2} vs {b:2, a:1} - are they equal?\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:43:21.716287-06:00","updated_at":"2026-01-04T13:43:21.716287-06:00","dependencies":[{"issue_id":"mondodb-8vr","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:50:05.339149-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-8vr","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:50:10.627188-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-8vr","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:50:15.934555-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-97k","title":"[REFACTOR] Cursor modifiers","description":"Refactor:\n- Fluent interface for chaining\n- Query plan optimization\n- Index hint support\n- Explain() for debugging","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:28:48.076627-06:00","updated_at":"2026-01-04T11:58:42.738255-06:00","closed_at":"2026-01-04T11:58:42.738255-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-97k","depends_on_id":"mondodb-ub7","type":"blocks","created_at":"2026-01-04T11:45:45.526625-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-9an","title":"TTL Indexes","description":"Implement TTL (Time-To-Live) indexes:\n- createIndex({field: 1}, {expireAfterSeconds: N})\n- Background cleanup of expired documents\n- Use SQLite triggers or periodic cleanup\n- Support for date fields","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-04T13:09:33.431799-06:00","updated_at":"2026-01-04T13:33:23.52255-06:00","closed_at":"2026-01-04T13:33:23.52255-06:00","close_reason":"Closed"}
{"id":"mondodb-9gu","title":"[RED] Project initialization with bun and TypeScript","description":"Write failing tests that verify:\n- package.json exists with correct dependencies\n- tsconfig.json is properly configured\n- bun.lockb is generated\n- Project builds without errors","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:12:41.679132-06:00","updated_at":"2026-01-04T12:01:25.222128-06:00","closed_at":"2026-01-04T12:01:25.222128-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-9gu","depends_on_id":"mondodb-eo7","type":"blocks","created_at":"2026-01-04T11:13:07.81197-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-9mf","title":"Compat tests: bulkWrite operations","description":"## Task\nCreate compatibility tests for bulkWrite operations.\n\n## Location\n`test/compatibility/bulk/bulk-write.compat.test.ts`\n\n## Test Cases\n\n### Basic Operations\n1. bulkWrite with insertOne operations\n2. bulkWrite with updateOne operations\n3. bulkWrite with updateMany operations\n4. bulkWrite with deleteOne operations\n5. bulkWrite with deleteMany operations\n6. bulkWrite with replaceOne operations\n7. Mixed operations in single bulkWrite\n\n### Result Structure\n```typescript\ninterface BulkWriteResult {\n  acknowledged: boolean\n  insertedCount: number\n  matchedCount: number\n  modifiedCount: number\n  deletedCount: number\n  upsertedCount: number\n  insertedIds: Record\u003cnumber, ObjectId\u003e\n  upsertedIds: Record\u003cnumber, ObjectId\u003e\n}\n```\n\n### ordered Option\n1. ordered:true (default) - stops on first error\n2. ordered:false - continues after errors\n3. Error contains partial results\n\n### Error Handling\n1. Duplicate key in bulkWrite\n2. Invalid operation in bulkWrite\n3. BulkWriteError structure\n4. writeErrors array in exception\n\n### Edge Cases\n1. Empty operations array\n2. Very large batch (1000+ operations)\n3. Operations on same document\n4. Upsert tracking in results","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:44:26.228553-06:00","updated_at":"2026-01-04T13:44:26.228553-06:00","dependencies":[{"issue_id":"mondodb-9mf","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:51:01.942182-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-9mf","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:51:07.230431-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-9mf","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:51:12.522859-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-ahu","title":"[RED] Aggregation pipeline stages","description":"Write failing tests for:\n- $match → WHERE clause\n- $project → SELECT with json_object\n- $group → GROUP BY with aggregates\n- $sort → ORDER BY\n- $limit → LIMIT\n- $skip → OFFSET\n- $count → COUNT(*)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:00.050166-06:00","updated_at":"2026-01-04T12:03:16.718769-06:00","closed_at":"2026-01-04T12:03:16.718769-06:00","close_reason":"Closed"}
{"id":"mondodb-ajb","title":"Aggregation pipeline async execution","description":"## Description\nModify aggregation execution to handle async $function stages.\n\n## TDD Test Cases (RED)\n```typescript\ndescribe('Aggregation with $function', () =\u003e {\n  describe('$addFields with $function', () =\u003e {\n    it('computes field using function')\n    it('can access multiple document fields')\n    it('works in pipeline with other stages')\n  })\n  \n  describe('$project with $function', () =\u003e {\n    it('projects computed function result')\n    it('combines with other projections')\n  })\n  \n  describe('pipeline ordering', () =\u003e {\n    it('executes $match before $function (optimization)')\n    it('passes filtered docs to function')\n    it('continues pipeline after function stage')\n  })\n  \n  describe('batch performance', () =\u003e {\n    it('batches all docs in stage to single isolate call')\n    it('handles 1000 documents efficiently')\n  })\n})\n```\n\n## Implementation Strategy\n1. Translator marks stages containing $function\n2. Executor splits pipeline at function boundaries\n3. SQL executes up to function stage\n4. FunctionExecutor processes batch\n5. Results feed into next SQL stage\n\n## Files\n- src/translator/aggregation-translator.ts\n- src/durable-object/mondo-database.ts (aggregate method)","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T13:31:43.470645-06:00","updated_at":"2026-01-04T13:58:39.515733-06:00","closed_at":"2026-01-04T13:58:39.515733-06:00","close_reason":"Implemented AggregationExecutor with 15 passing tests, full batch optimization","dependencies":[{"issue_id":"mondodb-ajb","depends_on_id":"mondodb-3ks","type":"blocks","created_at":"2026-01-04T13:32:44.188823-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-ajb","depends_on_id":"mondodb-4jc","type":"blocks","created_at":"2026-01-04T13:32:49.461142-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-aug","title":"Epic: MongoDB API Compatibility Testing Infrastructure","description":"## Overview\nBuild comprehensive testing infrastructure to ensure perfect API compatibility between mondodb and MongoDB (via mongo-memory-server).\n\n## Architecture\n- **Provider Abstraction Layer**: Unified interface for both backends\n- **Side-by-Side Execution**: Run identical operations on both databases  \n- **Structural Comparison**: Deep equality with ObjectId normalization\n- **Comprehensive Coverage**: Every operator, every edge case\n\n## Goals\n1. Verify identical return value structures\n2. Verify identical error codes and conditions\n3. Verify identical query/update operator semantics\n4. Generate compatibility reports for tracking\n\n## Test Categories\n- CRUD Operations (insert, find, update, delete, replace)\n- Query Operators (comparison, logical, element, array, evaluation)\n- Update Operators (field, array, misc)\n- Aggregation Pipeline\n- Cursor Behavior\n- Bulk Write Operations\n- Edge Cases (null, empty, nested, unicode)\n- Error Conditions","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-04T13:37:16.831441-06:00","updated_at":"2026-01-04T13:37:16.831441-06:00"}
{"id":"mondodb-ax4","title":"[REFACTOR] Project initialization with bun and TypeScript","description":"Refactor:\n- Optimize tsconfig paths and aliases\n- Configure bundle optimization\n- Set up proper export maps in package.json\n- Add development vs production configurations","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:12:53.737833-06:00","updated_at":"2026-01-04T12:07:04.55234-06:00","closed_at":"2026-01-04T12:07:04.55234-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-ax4","depends_on_id":"mondodb-owj","type":"blocks","created_at":"2026-01-04T11:13:18.274546-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-b2f","title":"[RED] Element and array query operators","description":"Write failing tests for:\n- $exists → json_extract IS NOT NULL / IS NULL\n- $type → json_type check\n- $all → array contains all elements\n- $elemMatch → array element matches\n- $size → json_array_length","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:17:54.193885-06:00","updated_at":"2026-01-04T11:58:26.707643-06:00","closed_at":"2026-01-04T11:58:26.707643-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-b2f","depends_on_id":"mondodb-gtx","type":"blocks","created_at":"2026-01-04T11:22:08.128771-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-b4u","title":"[EPIC] Cursor Operations","description":"Implement MongoCursor with toArray, forEach, limit, skip, sort, and iterator support.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T11:14:06.328107-06:00","updated_at":"2026-01-04T12:07:04.553596-06:00","closed_at":"2026-01-04T12:07:04.553596-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-b4u","depends_on_id":"mondodb-mzh","type":"blocks","created_at":"2026-01-04T11:39:51.600747-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-brb","title":"Compat tests: insertOne and insertMany","description":"## Task\nCreate compatibility tests for insert operations.\n\n## Location\n`test/compatibility/crud/insert.compat.test.ts`\n\n## Test Cases\n\n### insertOne\n1. Basic document insert - verify InsertOneResult structure\n2. Document with `_id` provided - preserves _id\n3. Document without `_id` - generates ObjectId\n4. Nested document insert\n5. Array field insert\n6. Duplicate _id throws error code 11000\n7. Empty document insert\n8. Document with null values\n9. Document with undefined values (behavior may differ!)\n10. Large document insert\n\n### insertMany\n1. Multiple documents - verify InsertManyResult structure\n2. insertedIds mapping is correct\n3. insertedCount matches array length\n4. Partial failure with ordered:true stops at first error\n5. Partial failure with ordered:false continues\n6. Empty array behavior\n7. Single document in array\n\n## Test Pattern\n```typescript\ndescribe('insertOne Compatibility', () =\u003e {\n  let mongodb: TestProvider\n  let mondodb: TestProvider\n  \n  beforeAll(async () =\u003e {\n    ;({ mongodb, mondodb } = await createBothProviders())\n  })\n  \n  afterAll(async () =\u003e {\n    await Promise.all([mongodb.disconnect(), mondodb.disconnect()])\n  })\n  \n  it('returns matching InsertOneResult structure', async () =\u003e {\n    const doc = { name: 'test', count: 42 }\n    \n    const mongoResult = await mongodb.database('test').collection('items').insertOne(doc)\n    const mondoResult = await mondodb.database('test').collection('items').insertOne({...doc})\n    \n    const comparison = compareResults(mongoResult, mondoResult, {\n      normalizeObjectIds: true\n    })\n    \n    expect(comparison.match).toBe(true)\n    if (!comparison.match) {\n      console.log('Differences:', comparison.differences)\n    }\n  })\n})\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:39:42.787922-06:00","updated_at":"2026-01-04T13:39:42.787922-06:00","dependencies":[{"issue_id":"mondodb-brb","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:46:44.817274-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-brb","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:46:50.144934-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-brb","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:46:55.443769-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-byh","title":"[RED] MongoCollection CRUD","description":"Write failing tests for:\n- collection.insertOne(doc)\n- collection.insertMany(docs)\n- collection.findOne(filter)\n- collection.find(filter) returns cursor\n- collection.updateOne(filter, update)\n- collection.updateMany(filter, update)\n- collection.deleteOne(filter)\n- collection.deleteMany(filter)\n- collection.replaceOne(filter, doc)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:25:56.272381-06:00","updated_at":"2026-01-04T12:01:28.034976-06:00","closed_at":"2026-01-04T12:01:28.034976-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-byh","depends_on_id":"mondodb-pfn","type":"blocks","created_at":"2026-01-04T11:42:03.1315-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-c3e","title":"[REFACTOR] Index management","description":"Refactor:\n- Index name generation\n- Background index creation\n- Index usage hints in queries\n- Sparse index support\n- TTL index simulation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:39:02.888057-06:00","updated_at":"2026-01-04T12:01:46.193891-06:00","closed_at":"2026-01-04T12:01:46.193891-06:00","close_reason":"Closed"}
{"id":"mondodb-cdl","title":"[GREEN] Miniflare local development","description":"Implement:\n- Miniflare config with durableObjectsPersist\n- Test helper for DO namespace access\n- vitest-pool-workers integration\n- Fixture utilities for test data\n- Environment setup scripts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:37:47.348915-06:00","updated_at":"2026-01-04T12:03:09.174536-06:00","closed_at":"2026-01-04T12:03:09.174536-06:00","close_reason":"Closed"}
{"id":"mondodb-cht","title":"[RED] SQLite schema initialization","description":"Write failing tests for:\n- Schema creates collections table\n- Schema creates documents table with JSON storage\n- Schema creates _id index\n- blockConcurrencyWhile ensures atomic init\n- Schema version tracking","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:14:58.515074-06:00","updated_at":"2026-01-04T11:55:40.357931-06:00","closed_at":"2026-01-04T11:55:40.357931-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-cht","depends_on_id":"mondodb-0js","type":"blocks","created_at":"2026-01-04T11:16:03.265671-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-cnm","title":"Types and interfaces for $function","description":"## Description\nDefine TypeScript types for $function feature.\n\n## TDD Test Cases (RED)\n```typescript\ndescribe('Function types', () =\u003e {\n  it('FunctionSpec has body, args, lang')\n  it('WorkerLoader type matches CF binding')\n  it('Env.LOADER is optional')\n  it('FunctionResult includes value and error')\n})\n```\n\n## Types to Define\n```typescript\n// src/types/function.ts\n\nexport interface FunctionSpec {\n  body: string | ((...args: unknown[]) =\u003e unknown)\n  args: unknown[]\n  lang: 'js'\n}\n\nexport interface FunctionResult {\n  success: boolean\n  value?: unknown\n  error?: string\n  duration: number\n}\n\nexport interface FunctionExpression {\n  __type: 'function'\n  body: string\n  argPaths: string[]\n  literalArgs: Map\u003cnumber, unknown\u003e\n}\n\n// Worker loader types (match CF API)\nexport interface WorkerLoader {\n  get(id: string, getCode: () =\u003e Promise\u003cWorkerCode\u003e): WorkerStub\n}\n\nexport interface WorkerCode {\n  compatibilityDate: string\n  mainModule: string\n  modules: Record\u003cstring, string\u003e\n  globalOutbound?: null\n  env?: Record\u003cstring, unknown\u003e\n}\n\nexport interface WorkerStub {\n  getEntrypoint(): WorkerEntrypoint\n}\n\nexport interface WorkerEntrypoint {\n  fetch(request: Request): Promise\u003cResponse\u003e\n}\n```\n\n## Files\n- src/types/function.ts\n- src/types/index.ts (re-export)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T13:31:49.721532-06:00","updated_at":"2026-01-04T13:39:47.062117-06:00","closed_at":"2026-01-04T13:39:47.062117-06:00","close_reason":"Implemented types and converted wrangler.toml to wrangler.jsonc with worker_loaders binding"}
{"id":"mondodb-cny","title":"Implement MongoDBProvider (mongo-memory-server wrapper)","description":"## Task\nImplement TestProvider for real MongoDB using mongo-memory-server.\n\n## Location\n`test/compatibility/providers/mongodb-provider.ts`\n\n## Implementation\n```typescript\nimport { MongoClient, Db, Collection } from 'mongodb'\nimport { MongoMemoryServer } from 'mongodb-memory-server'\nimport { TestProvider, TestDatabase, TestCollection, TestCursor } from './types'\n\nexport class MongoDBProvider implements TestProvider {\n  readonly name = 'mongodb' as const\n  private server!: MongoMemoryServer\n  private client!: MongoClient\n  \n  async connect(): Promise\u003cvoid\u003e {\n    this.server = await MongoMemoryServer.create()\n    const uri = this.server.getUri()\n    this.client = new MongoClient(uri)\n    await this.client.connect()\n  }\n  \n  async disconnect(): Promise\u003cvoid\u003e {\n    await this.client?.close()\n    await this.server?.stop()\n  }\n  \n  database(name: string): TestDatabase {\n    return new MongoDBDatabase(this.client.db(name))\n  }\n  \n  async dropDatabase(name: string): Promise\u003cvoid\u003e {\n    await this.client.db(name).dropDatabase()\n  }\n}\n\nclass MongoDBDatabase implements TestDatabase {\n  constructor(private db: Db) {}\n  \n  get databaseName(): string { return this.db.databaseName }\n  \n  collection\u003cT\u003e(name: string): TestCollection\u003cT\u003e {\n    return new MongoDBCollection(this.db.collection(name))\n  }\n  // ...\n}\n\n// Wrap MongoDB Collection to match TestCollection interface\nclass MongoDBCollection\u003cT\u003e implements TestCollection\u003cT\u003e {\n  // Direct passthrough to MongoDB driver methods\n}\n\n// Wrap MongoDB Cursor to match TestCursor interface\nclass MongoDBCursor\u003cT\u003e implements TestCursor\u003cT\u003e {\n  // Direct passthrough to MongoDB cursor methods  \n}\n```\n\n## TDD Tests\n1. Can create MongoMemoryServer and connect\n2. Can perform basic CRUD operations\n3. Can disconnect and cleanup\n4. Multiple databases work independently","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-04T13:38:12.748285-06:00","updated_at":"2026-01-04T13:38:12.748285-06:00","dependencies":[{"issue_id":"mondodb-cny","depends_on_id":"mondodb-3kh","type":"blocks","created_at":"2026-01-04T13:45:38.829181-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-cr6","title":"Integration tests for $function","description":"## Description\nEnd-to-end integration tests using actual worker-loader binding.\n\n## TDD Test Cases (RED)\n```typescript\ndescribe('Integration: $function', () =\u003e {\n  describe('real isolate execution', () =\u003e {\n    it('executes in actual V8 isolate')\n    it('maintains isolation between calls')\n    it('respects timeout limits')\n  })\n  \n  describe('full aggregation pipeline', () =\u003e {\n    it('$match → $addFields with $function → $sort')\n    it('$group → $project with $function')\n    it('multiple $function stages in pipeline')\n  })\n  \n  describe('error handling', () =\u003e {\n    it('syntax error in function body')\n    it('runtime error in function')\n    it('timeout exceeded')\n    it('missing LOADER binding')\n  })\n  \n  describe('MongoDB compatibility', () =\u003e {\n    it('matches MongoDB $function behavior')\n    it('handles same args as MongoDB')\n    it('returns compatible results')\n  })\n})\n```\n\n## Test Setup\n- Configure [[worker_loaders]] in test wrangler.toml\n- May need miniflare configuration for local testing\n\n## Files\n- test/integration/function.test.ts\n- test/fixtures/function-data.ts","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:32:10.706268-06:00","updated_at":"2026-01-04T13:32:10.706268-06:00","dependencies":[{"issue_id":"mondodb-cr6","depends_on_id":"mondodb-ajb","type":"blocks","created_at":"2026-01-04T13:32:54.734601-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-cr6","depends_on_id":"mondodb-f34","type":"blocks","created_at":"2026-01-04T13:33:00.011112-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-dhu","title":"[EPIC] Index Management","description":"Implement createIndex, dropIndex, listIndexes with SQLite index backing.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T11:14:31.12591-06:00","updated_at":"2026-01-04T12:07:04.55512-06:00","closed_at":"2026-01-04T12:07:04.55512-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-dhu","depends_on_id":"mondodb-86g","type":"blocks","created_at":"2026-01-04T11:40:12.512391-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-dq8","title":"[GREEN] Workers RPC service binding","description":"Implement:\n- MondoEntrypoint extending WorkerEntrypoint\n- Expose connect/db/collection methods\n- Configure service binding in wrangler\n- Pass Durable Object stubs correctly\n- Method return types with RpcTarget","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:31:08.469435-06:00","updated_at":"2026-01-04T12:00:42.582972-06:00","closed_at":"2026-01-04T12:00:42.582972-06:00","close_reason":"Closed"}
{"id":"mondodb-dv4","title":"Compat tests: Array query operators","description":"## Task\nCreate compatibility tests for array query operators.\n\n## Location\n`test/compatibility/query-operators/array.compat.test.ts`\n\n## Operators\n- $all - All elements match\n- $elemMatch - Element matches all conditions\n- $size - Array size\n\n## Test Cases\n\n### $all\n1. Array contains all specified elements\n2. Order doesn't matter\n3. $all with single element\n4. $all with empty array\n5. $all on non-array field (behavior?)\n6. $all with $elemMatch inside\n\n### $elemMatch\n1. Element matches multiple conditions\n2. $elemMatch vs individual conditions (subtle difference!)\n3. $elemMatch with comparison operators\n4. $elemMatch with nested fields\n5. $elemMatch on array of primitives\n6. $elemMatch on array of objects\n\n### $size\n1. Array has exact size\n2. $size:0 matches empty arrays\n3. $size on non-array field\n4. Cannot use $size with range (need $where or aggregation)\n\n## Critical Edge Case\n```javascript\n// These are DIFFERENT:\n{ arr: { x: 1, y: 2 } }           // One element matches x:1, another matches y:2\n{ arr: { $elemMatch: { x: 1, y: 2 } } }  // Same element must match both\n\n// Example:\ndoc = { arr: [{ x: 1 }, { y: 2 }] }\n// First query: MATCHES (x:1 in first elem, y:2 in second)\n// Second query: NO MATCH (no single elem has both)\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:42:25.511605-06:00","updated_at":"2026-01-04T13:42:25.511605-06:00","dependencies":[{"issue_id":"mondodb-dv4","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:49:17.718167-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-dv4","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:49:23.003679-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-dv4","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:49:28.281352-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-dzz","title":"[RED] capnweb RPC client","description":"Write failing tests for:\n- newHttpBatchRpcSession creates client\n- newWebSocketRpcSession for streaming\n- MongoClient uses RPC session\n- Method calls return promises\n- Stubs properly disposed with using\n- Promise pipelining works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:30:44.19728-06:00","updated_at":"2026-01-04T12:00:42.581218-06:00","closed_at":"2026-01-04T12:00:42.581218-06:00","close_reason":"Closed"}
{"id":"mondodb-e1b","title":"[GREEN] Advanced aggregation stages","description":"Implement:\n- $lookup using LEFT JOIN with subquery\n- $unwind using json_each expansion\n- $addFields as computed json_set\n- $bucket with CASE WHEN ranges\n- $facet with multiple CTEs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:25.052427-06:00","updated_at":"2026-01-04T12:03:16.721202-06:00","closed_at":"2026-01-04T12:03:16.721202-06:00","close_reason":"Closed"}
{"id":"mondodb-e6p","title":"[EPIC] MongoClient API","description":"Implement MongoDB Node.js driver compatible MongoClient, MongoDatabase, and MongoCollection classes.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T11:13:59.825094-06:00","updated_at":"2026-01-04T12:07:04.553967-06:00","closed_at":"2026-01-04T12:07:04.553967-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-e6p","depends_on_id":"mondodb-2ht","type":"blocks","created_at":"2026-01-04T11:39:46.381776-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-eh0","title":"Create vitest config and test infrastructure for compat tests","description":"## Task\nSet up vitest configuration and infrastructure for compatibility tests.\n\n## Files to Create\n\n### `vitest.config.compat.ts`\n```typescript\nimport { defineConfig } from 'vitest/config'\n\nexport default defineConfig({\n  test: {\n    include: ['test/compatibility/**/*.compat.test.ts'],\n    exclude: ['node_modules', 'dist'],\n    testTimeout: 60000,  // mongo-memory-server can be slow to start\n    hookTimeout: 30000,\n    pool: 'forks',       // Isolate tests for clean state\n    globals: true,\n    reporters: ['verbose', 'json'],\n    outputFile: {\n      json: './compat-report.json'\n    }\n  }\n})\n```\n\n### `test/compatibility/providers/factory.ts`\n```typescript\nimport { TestProvider } from './types'\nimport { MongoDBProvider } from './mongodb-provider'\nimport { MondoDBProvider } from './mondodb-provider'\n\nexport type ProviderName = 'mongodb' | 'mondodb'\n\nexport async function createProvider(name: ProviderName): Promise\u003cTestProvider\u003e {\n  const provider = name === 'mongodb' \n    ? new MongoDBProvider()\n    : new MondoDBProvider()\n  await provider.connect()\n  return provider\n}\n\nexport async function createBothProviders(): Promise\u003c{\n  mongodb: TestProvider\n  mondodb: TestProvider\n}\u003e {\n  const [mongodb, mondodb] = await Promise.all([\n    createProvider('mongodb'),\n    createProvider('mondodb')\n  ])\n  return { mongodb, mondodb }\n}\n```\n\n### `test/compatibility/setup.ts` (global setup)\n```typescript\nexport async function setup() {\n  // Pre-download MongoDB binaries to avoid test timeout\n  console.log('Ensuring MongoDB binaries are available...')\n}\n\nexport async function teardown() {\n  // Cleanup\n}\n```\n\n### `package.json` scripts\n```json\n{\n  \"scripts\": {\n    \"test:compat\": \"vitest run --config vitest.config.compat.ts\",\n    \"test:compat:watch\": \"vitest --config vitest.config.compat.ts\",\n    \"test:compat:ui\": \"vitest --config vitest.config.compat.ts --ui\"\n  }\n}\n```\n\n## TDD\n1. `npm run test:compat` runs without error (even with no tests)\n2. Test files matching `*.compat.test.ts` are discovered\n3. Both providers can be created via factory","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T13:39:14.320608-06:00","updated_at":"2026-01-04T13:55:19.851103-06:00","closed_at":"2026-01-04T13:55:19.851103-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-eh0","depends_on_id":"mondodb-8qj","type":"blocks","created_at":"2026-01-04T13:45:54.696698-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-eo7","title":"[EPIC] Project Setup \u0026 Infrastructure","description":"Set up the mondodb project with bun, TypeScript, and required dependencies for building a MongoDB-compatible database on Cloudflare Durable Objects.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-04T11:12:24.521265-06:00","updated_at":"2026-01-04T12:07:44.920422-06:00","closed_at":"2026-01-04T12:07:44.920422-06:00","close_reason":"Project setup complete with all 73 tasks implemented"}
{"id":"mondodb-f34","title":"wrangler.jsonc worker-loader configuration","description":"## Description\nAdd worker_loaders binding configuration to wrangler.jsonc.\n\n## Changes\n```jsonc\n// Add to wrangler.jsonc\n{\n  \"worker_loaders\": [\n    {\n      \"binding\": \"LOADER\"\n    }\n  ]\n}\n```\n\n## Documentation\n- Update README with $function feature\n- Document wrangler.jsonc requirements\n- Add example usage\n\n## Testing\n- Verify binding appears in env\n- Test with/without binding configured","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-04T13:32:17.455729-06:00","updated_at":"2026-01-04T13:39:53.503758-06:00"}
{"id":"mondodb-f3m","title":"[REFACTOR] Advanced aggregation stages","description":"Refactor:\n- Join optimization\n- Parallel facet execution\n- Memory management for large unwinds\n- Query plan analysis","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:31.200389-06:00","updated_at":"2026-01-04T12:03:16.721624-06:00","closed_at":"2026-01-04T12:03:16.721624-06:00","close_reason":"Closed"}
{"id":"mondodb-fa9","title":"[RED] Miniflare local development","description":"Write failing tests for:\n- Miniflare configuration for mondodb DO\n- File system persistence between tests\n- Direct DO namespace access for testing\n- Schema initialization works locally\n- CRUD operations match production behavior","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:37:39.432921-06:00","updated_at":"2026-01-04T12:03:09.173521-06:00","closed_at":"2026-01-04T12:03:09.173521-06:00","close_reason":"Closed"}
{"id":"mondodb-fuq","title":"[RED] Field update operators","description":"Write failing tests for:\n- $set → json_set(data, path, value)\n- $unset → json_remove(data, path)\n- $inc → json_set(data, path, json_extract+increment)\n- $min/$max → conditional update\n- $mul → multiplication update\n- $rename → remove+set combination","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:22:29.749153-06:00","updated_at":"2026-01-04T11:59:48.987829-06:00","closed_at":"2026-01-04T11:59:48.987829-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-fuq","depends_on_id":"mondodb-rsu","type":"blocks","created_at":"2026-01-04T11:40:59.008382-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-g6z","title":"[REFACTOR] ObjectId generation","description":"Refactor:\n- Optimize random byte generation\n- Cache counter state\n- Add BSON compatibility\n- Type-safe ObjectId class","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:48.646312-06:00","updated_at":"2026-01-04T11:54:25.868898-06:00","closed_at":"2026-01-04T11:54:25.868898-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-g6z","depends_on_id":"mondodb-ypw","type":"blocks","created_at":"2026-01-04T11:16:45.081407-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-gtx","title":"[REFACTOR] Logical query operators","description":"Refactor:\n- Flatten nested $and/$or\n- Remove redundant conditions\n- Optimize deep nesting\n- Add query plan hints","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:17:48.21755-06:00","updated_at":"2026-01-04T11:58:26.706919-06:00","closed_at":"2026-01-04T11:58:26.706919-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-gtx","depends_on_id":"mondodb-7io","type":"blocks","created_at":"2026-01-04T11:19:17.506984-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-gu8","title":"[REFACTOR] Miniflare local development","description":"Refactor:\n- Test isolation improvements\n- Parallel test support\n- Custom persistence paths per suite\n- Debug utilities for storage inspection","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:37:53.782553-06:00","updated_at":"2026-01-04T12:03:09.175129-06:00","closed_at":"2026-01-04T12:03:09.175129-06:00","close_reason":"Closed"}
{"id":"mondodb-h0o","title":"Change Streams - watch() functionality","description":"Implement MongoDB-compatible change streams:\n- collection.watch() returns a ChangeStream cursor\n- Support for change events: insert, update, delete, replace\n- Filter with $match pipeline stage\n- resumeAfter/startAfter tokens for resumption\n- fullDocument option for update events","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T13:09:33.413846-06:00","updated_at":"2026-01-04T13:33:23.521717-06:00","closed_at":"2026-01-04T13:33:23.521717-06:00","close_reason":"Closed"}
{"id":"mondodb-i0r","title":"[GREEN] Comparison query operators","description":"Implement QueryTranslator class with:\n- translateComparison() for each operator\n- Path extraction with json_extract\n- Parameterized value binding\n- Nested path handling ($.a.b.c)\n- Type coercion for numbers/strings","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:17:22.889548-06:00","updated_at":"2026-01-04T11:58:26.704982-06:00","closed_at":"2026-01-04T11:58:26.704982-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-i0r","depends_on_id":"mondodb-67o","type":"blocks","created_at":"2026-01-04T11:18:56.607992-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-i7a","title":"[REFACTOR] Workers RPC service binding","description":"Refactor:\n- TypeScript declarations for service bindings\n- Environment type safety\n- Multiple database support\n- Permission model","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:31:14.78036-06:00","updated_at":"2026-01-04T12:00:42.58338-06:00","closed_at":"2026-01-04T12:00:42.58338-06:00","close_reason":"Closed"}
{"id":"mondodb-i9l","title":"[RED] Index management","description":"Write failing tests for:\n- collection.createIndex({field: 1}) creates ascending index\n- collection.createIndex({a: 1, b: -1}) compound index\n- collection.createIndex with unique option\n- collection.listIndexes() returns index info\n- collection.dropIndex(name) removes index\n- collection.dropIndexes() removes all","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:50.671708-06:00","updated_at":"2026-01-04T12:01:46.192303-06:00","closed_at":"2026-01-04T12:01:46.192303-06:00","close_reason":"Closed"}
{"id":"mondodb-irc","title":"Epic: $function - Secure User Code Execution","description":"Enable MongoDB $function operator using Cloudflare worker-loader for secure V8 isolate execution.\n\n## Overview\nMongoDB deprecated $function due to security concerns. We can bring it back securely using:\n- Cloudflare worker-loader binding for V8 isolate sandboxing\n- globalOutbound: null to block network access\n- Empty env to prevent binding access\n- Timeout enforcement\n\n## Capability Detection\n- Check for env.LOADER presence\n- If absent and $function used → helpful error with wrangler.toml instructions\n- No ALLOW_FUNCTIONS flag needed\n\n## Security Model\n| Layer | Mechanism |\n|-------|-----------|\n| Network | globalOutbound: null |\n| Bindings | Empty env: {} |\n| Time | Configurable timeout |\n| Data | Serialized copies only |\n\n## Scope\n1. Core FunctionExecutor module\n2. Expression translator integration\n3. Aggregation pipeline async support\n4. Unit + integration tests (TDD)\n\n## Out of Scope (Future)\n- $accumulator for custom group operations\n- $where query predicate\n- Function registry for pre-approved functions","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-04T13:30:46.198467-06:00","updated_at":"2026-01-04T13:30:46.198467-06:00"}
{"id":"mondodb-iua","title":"[RED] Array update operators","description":"Write failing tests for:\n- $push → json_insert with array append\n- $pull → json_remove matching elements\n- $addToSet → push if not exists\n- $pop → remove first/last element\n- $each modifier for batch operations\n- $slice modifier for limiting array size","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:22:48.455338-06:00","updated_at":"2026-01-04T11:59:48.989548-06:00","closed_at":"2026-01-04T11:59:48.989548-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-iua","depends_on_id":"mondodb-ja8","type":"blocks","created_at":"2026-01-04T11:41:14.966287-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-j84","title":"[RED] Cursor modifiers","description":"Write failing tests for:\n- cursor.limit(n) limits results\n- cursor.skip(n) skips first n\n- cursor.sort({field: 1/-1}) orders results\n- cursor.project({field: 1}) selects fields\n- Chained modifiers work together\n- Modifiers before iteration only","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:28:35.517135-06:00","updated_at":"2026-01-04T11:58:42.737363-06:00","closed_at":"2026-01-04T11:58:42.737363-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-j84","depends_on_id":"mondodb-2r5","type":"blocks","created_at":"2026-01-04T11:45:34.788057-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-ja8","title":"[REFACTOR] Field update operators","description":"Refactor:\n- Combine multiple json_set calls\n- Optimize nested path updates\n- Add validation for update operators\n- Handle conflicts between operators","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:22:42.146533-06:00","updated_at":"2026-01-04T11:59:48.989095-06:00","closed_at":"2026-01-04T11:59:48.989095-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-ja8","depends_on_id":"mondodb-nqp","type":"blocks","created_at":"2026-01-04T11:41:09.626941-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-jqi","title":"Compat tests: Cursor behavior","description":"## Task\nCreate compatibility tests for cursor behavior.\n\n## Location\n`test/compatibility/cursor/cursor.compat.test.ts`\n\n## Test Cases\n\n### Iteration Methods\n1. cursor.toArray() returns all documents\n2. cursor.next() returns one at a time\n3. cursor.next() returns null after exhausted\n4. cursor.hasNext() correctness\n5. for await...of iteration\n6. cursor.forEach() callback\n7. cursor.map() transformation\n\n### Modifiers (before execution)\n1. cursor.limit(n) restricts results\n2. cursor.skip(n) offsets results  \n3. cursor.sort(spec) orders results\n4. cursor.project(spec) shapes results\n5. Chaining modifiers\n6. Modifier order doesn't matter (before execution)\n7. Modifier after execution throws?\n\n### Batching\n1. cursor.batchSize() affects retrieval\n2. Default batch size\n3. Large result set pagination\n\n### State\n1. Cursor tracks position\n2. Cursor can be closed\n3. Cursor auto-closes when exhausted\n4. cursor.closed property\n5. Operations on closed cursor\n\n### Edge Cases\n1. Empty result cursor\n2. Single document cursor\n3. Very large result set (memory)\n4. Cursor timeout behavior (if applicable)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:44:08.642696-06:00","updated_at":"2026-01-04T13:44:08.642696-06:00","dependencies":[{"issue_id":"mondodb-jqi","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:50:46.090243-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-jqi","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:50:51.376242-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-jqi","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:50:56.660873-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-k3r","title":"[REFACTOR] SQLite schema initialization","description":"Refactor:\n- Extract schema migrations to separate module\n- Add schema versioning support\n- Optimize index creation\n- Add validation for schema integrity","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:10.71161-06:00","updated_at":"2026-01-04T11:55:40.35962-06:00","closed_at":"2026-01-04T11:55:40.35962-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-k3r","depends_on_id":"mondodb-n47","type":"blocks","created_at":"2026-01-04T11:16:13.715385-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-k7x","title":"Bulk Write Operations","description":"Implement bulk write operations:\n- collection.bulkWrite([operations])\n- insertOne, updateOne, updateMany, deleteOne, deleteMany, replaceOne\n- ordered vs unordered execution\n- Return BulkWriteResult with counts\n- Proper error handling for partial failures","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T13:09:33.424901-06:00","updated_at":"2026-01-04T13:33:23.52215-06:00","closed_at":"2026-01-04T13:33:23.52215-06:00","close_reason":"Closed"}
{"id":"mondodb-koc","title":"[GREEN] Aggregation pipeline stages","description":"Implement AggregationTranslator:\n- Pipeline stage dispatcher\n- $match using QueryTranslator\n- $project with field mapping\n- $group with SUM, AVG, MIN, MAX, COUNT\n- Sort/limit/skip as SQL clauses\n- CTE-based pipeline execution","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:06.299513-06:00","updated_at":"2026-01-04T12:03:16.719753-06:00","closed_at":"2026-01-04T12:03:16.719753-06:00","close_reason":"Closed"}
{"id":"mondodb-kv0","title":"Create comparison utilities for result verification","description":"## Task\nBuild deep comparison utilities that can verify mondodb results match MongoDB results.\n\n## Location\n`test/compatibility/compare.ts`\n\n## Implementation\n```typescript\nexport interface CompareOptions {\n  ignoreFields?: string[]          // Skip specific fields\n  normalizeObjectIds?: boolean     // Compare ObjectId types, not values\n  ignoreArrayOrder?: boolean       // For unordered results\n  compareDates?: boolean           // Date comparison tolerance\n  path?: string                    // Current path for error reporting\n}\n\nexport interface ComparisonResult {\n  match: boolean\n  differences: Difference[]\n}\n\nexport interface Difference {\n  path: string\n  type: 'missing' | 'extra' | 'value_mismatch' | 'type_mismatch'\n  expected: unknown  // MongoDB value\n  actual: unknown    // mondodb value\n  message: string\n}\n\nexport function compareResults\u003cT\u003e(\n  mongoResult: T,\n  mondoResult: T,\n  options: CompareOptions = {}\n): ComparisonResult\n\n// Deep comparison handling:\n// - ObjectId: compare instanceof, not exact value\n// - Arrays: element-by-element or unordered\n// - Nested objects: recursive with path tracking\n// - null vs undefined: strict\n// - Dates: within tolerance\n// - Numbers: exact or within epsilon\n\nexport function normalizeForComparison\u003cT\u003e(value: T): T\n// Strip non-deterministic values, normalize types\n\nexport function formatDifferences(diffs: Difference[]): string\n// Human-readable diff output\n```\n\n## Key Comparisons\n1. InsertOneResult: { acknowledged, insertedId }\n2. UpdateResult: { acknowledged, matchedCount, modifiedCount, upsertedId?, upsertedCount? }\n3. DeleteResult: { acknowledged, deletedCount }\n4. BulkWriteResult: all counts and id mappings\n5. Document arrays: content and order\n6. Error objects: code and message pattern\n\n## TDD Tests\n1. Identical results return match: true\n2. Different values detected with path\n3. ObjectId type matching (not value)\n4. Nested path reporting\n5. Array order handling\n6. Null vs undefined detection","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-04T13:38:53.477237-06:00","updated_at":"2026-01-04T13:38:53.477237-06:00","dependencies":[{"issue_id":"mondodb-kv0","depends_on_id":"mondodb-3kh","type":"blocks","created_at":"2026-01-04T13:45:49.412283-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-mzh","title":"[REFACTOR] MongoCollection CRUD","description":"Refactor:\n- Batch operation optimization\n- Upsert support\n- Write concern handling\n- Type-safe generics","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:26:23.512843-06:00","updated_at":"2026-01-04T12:01:28.035768-06:00","closed_at":"2026-01-04T12:01:28.035768-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-mzh","depends_on_id":"mondodb-65u","type":"blocks","created_at":"2026-01-04T11:42:13.857025-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-n47","title":"[GREEN] SQLite schema initialization","description":"Implement:\n- CREATE TABLE collections (id, name UNIQUE, options JSON)\n- CREATE TABLE documents (id, collection_id FK, _id UNIQUE, data JSON)\n- CREATE INDEX on documents._id\n- Use blockConcurrencyWhile for atomic schema init\n- Store schema_version in KV","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:04.742858-06:00","updated_at":"2026-01-04T11:55:40.358954-06:00","closed_at":"2026-01-04T11:55:40.358954-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-n47","depends_on_id":"mondodb-cht","type":"blocks","created_at":"2026-01-04T11:16:08.487677-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-nqp","title":"[GREEN] Field update operators","description":"Implement UpdateTranslator class:\n- translateFieldUpdate() for $set, $unset, $inc\n- Build json_set chains for multiple updates\n- Handle $min/$max with CASE WHEN\n- Proper type handling for numeric ops","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:22:36.004332-06:00","updated_at":"2026-01-04T11:59:48.98862-06:00","closed_at":"2026-01-04T11:59:48.98862-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-nqp","depends_on_id":"mondodb-fuq","type":"blocks","created_at":"2026-01-04T11:41:04.279633-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-nwl","title":"Compat tests: Comparison query operators","description":"## Task\nCreate compatibility tests for comparison query operators.\n\n## Location\n`test/compatibility/query-operators/comparison.compat.test.ts`\n\n## Operators to Test\n- $eq - Equal\n- $ne - Not equal\n- $gt - Greater than\n- $gte - Greater than or equal\n- $lt - Less than  \n- $lte - Less than or equal\n- $in - In array\n- $nin - Not in array\n\n## Test Cases per Operator\n\n### $eq\n1. Explicit $eq matches value\n2. Implicit equality (no operator)\n3. $eq with null\n4. $eq with ObjectId\n5. $eq with nested field\n6. $eq with array element\n\n### $ne\n1. $ne excludes matching values\n2. $ne with null (tricky!)\n3. $ne returns docs where field doesn't exist\n\n### $gt/$gte/$lt/$lte\n1. Number comparisons\n2. String comparisons (lexicographic)\n3. Date comparisons\n4. Boundary conditions (gte includes, gt excludes)\n5. Comparison with null\n6. Comparison with missing field\n\n### $in\n1. Match any value in array\n2. Empty array $in:[] - no matches\n3. $in with ObjectId array\n4. $in with null in array\n5. $in on array field (any element matches)\n\n### $nin  \n1. Exclude values in array\n2. Empty array $nin:[] - all match\n3. $nin includes docs where field missing\n\n## Critical Edge Cases\n- Type coercion behavior (string '5' vs number 5)\n- null vs undefined vs missing field\n- Array field matching semantics","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:41:30.318046-06:00","updated_at":"2026-01-04T13:41:30.318046-06:00","dependencies":[{"issue_id":"mondodb-nwl","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:48:30.085702-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-nwl","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:48:35.373184-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-nwl","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:48:40.659527-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-o6j","title":"[GREEN] MongoCursor iteration","description":"Implement MongoCursor class:\n- Wrap SQLite cursor with lazy iteration\n- Buffer management for batching\n- Async iterator implementation\n- forEach/map/toArray helpers\n- Proper resource cleanup","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:28:23.260816-06:00","updated_at":"2026-01-04T11:58:42.736335-06:00","closed_at":"2026-01-04T11:58:42.736335-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-o6j","depends_on_id":"mondodb-4l5","type":"blocks","created_at":"2026-01-04T11:42:24.597308-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-ob6","title":"[GREEN] MongoDatabase operations","description":"Implement MongoDatabase class:\n- Collection factory with caching\n- listCollections via SQL query\n- createCollection with options\n- dropCollection with CASCADE\n- command() dispatcher","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:25:43.87664-06:00","updated_at":"2026-01-04T12:01:28.034187-06:00","closed_at":"2026-01-04T12:01:28.034187-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-ob6","depends_on_id":"mondodb-5tq","type":"blocks","created_at":"2026-01-04T11:41:52.420662-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-omw","title":"[RED] Document CRUD operations in SQLite","description":"Write failing tests for:\n- insertOne stores document with auto _id\n- insertMany stores multiple documents\n- findOne retrieves by _id\n- find retrieves by query\n- updateOne modifies document\n- deleteOne removes document\n- JSON field extraction works","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:17.200959-06:00","updated_at":"2026-01-04T12:07:04.551481-06:00","closed_at":"2026-01-04T12:07:04.551481-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-omw","depends_on_id":"mondodb-k3r","type":"blocks","created_at":"2026-01-04T11:16:18.948254-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-ovt","title":"[GREEN] Index management","description":"Implement:\n- CREATE INDEX on json_extract expressions\n- Compound index with multiple columns\n- UNIQUE INDEX for unique constraint\n- Index metadata storage in collections table\n- DROP INDEX with name mapping\n- List indexes from SQLite schema","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:56.946913-06:00","updated_at":"2026-01-04T12:01:46.19329-06:00","closed_at":"2026-01-04T12:01:46.19329-06:00","close_reason":"Closed"}
{"id":"mondodb-owj","title":"[GREEN] Project initialization with bun and TypeScript","description":"Implement:\n- Initialize bun project with package.json\n- Configure TypeScript with strict mode\n- Add dependencies: capnweb, @cloudflare/workers-types\n- Configure wrangler.toml for Durable Objects\n- Set up build scripts","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:12:47.836146-06:00","updated_at":"2026-01-04T12:01:25.223344-06:00","closed_at":"2026-01-04T12:01:25.223344-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-owj","depends_on_id":"mondodb-9gu","type":"blocks","created_at":"2026-01-04T11:13:13.036539-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-pf7","title":"[EPIC] RPC Layer - capnweb \u0026 Workers RPC","description":"Expose mondodb API via capnweb for browser/external clients and Workers RPC for service bindings.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T11:14:18.799754-06:00","updated_at":"2026-01-04T12:07:04.553219-06:00","closed_at":"2026-01-04T12:07:04.553219-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-pf7","depends_on_id":"mondodb-mzh","type":"blocks","created_at":"2026-01-04T11:39:56.829286-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-pfn","title":"[REFACTOR] MongoDatabase operations","description":"Refactor:\n- Collection instance caching\n- Batch collection operations\n- Validation schema support\n- Stats and profiling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:25:50.272137-06:00","updated_at":"2026-01-04T12:01:28.034585-06:00","closed_at":"2026-01-04T12:01:28.034585-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-pfn","depends_on_id":"mondodb-ob6","type":"blocks","created_at":"2026-01-04T11:41:57.774867-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-q9e","title":"Compat tests: Logical query operators","description":"## Task\nCreate compatibility tests for logical query operators.\n\n## Location\n`test/compatibility/query-operators/logical.compat.test.ts`\n\n## Operators\n- $and - Logical AND\n- $or - Logical OR  \n- $nor - Logical NOR\n- $not - Logical NOT\n\n## Test Cases\n\n### $and\n1. Explicit $and with multiple conditions\n2. Implicit $and (multiple fields in filter)\n3. $and with same field multiple times\n4. $and with nested $or\n5. Empty $and array behavior\n\n### $or\n1. Match any condition\n2. $or with overlapping matches (no duplicates)\n3. $or with complex nested conditions\n4. Empty $or array behavior\n5. Single condition in $or\n\n### $nor\n1. Exclude all matching conditions\n2. $nor vs $not + $or equivalence\n3. Empty $nor array behavior\n\n### $not\n1. $not with comparison operator\n2. $not with $regex\n3. $not with $in\n4. Double negation behavior\n5. $not cannot wrap $and/$or directly\n\n## Edge Cases\n- Deeply nested logical operators\n- Logical operators with array fields\n- Short-circuit evaluation (if any)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:41:46.802528-06:00","updated_at":"2026-01-04T13:41:46.802528-06:00","dependencies":[{"issue_id":"mondodb-q9e","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:48:45.953387-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-q9e","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:48:51.244049-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-q9e","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:48:56.535873-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-qow","title":"[GREEN] MongoClient connection","description":"Implement MongoClient class:\n- URI parser for mondodb:// scheme\n- RPC session creation via capnweb\n- Connection state management\n- Database name extraction\n- db() factory method","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:24:24.952429-06:00","updated_at":"2026-01-04T12:01:28.032899-06:00","closed_at":"2026-01-04T12:01:28.032899-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-qow","depends_on_id":"mondodb-0ve","type":"blocks","created_at":"2026-01-04T11:41:36.351367-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-rcz","title":"[RED] Advanced aggregation stages","description":"Write failing tests for:\n- $lookup → LEFT JOIN\n- $unwind → array expansion\n- $addFields → computed columns\n- $bucket → range grouping\n- $facet → multi-pipeline execution","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:18.924772-06:00","updated_at":"2026-01-04T12:03:16.720783-06:00","closed_at":"2026-01-04T12:03:16.720783-06:00","close_reason":"Closed"}
{"id":"mondodb-rsu","title":"[EPIC] Update Translation Engine","description":"Translate MongoDB update operators ($set, $inc, $push, etc.) to SQL UPDATE statements.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-04T11:13:53.729902-06:00","updated_at":"2026-01-04T12:07:04.554357-06:00","closed_at":"2026-01-04T12:07:04.554357-06:00","close_reason":"Implementation complete - 539/570 tests passing","dependencies":[{"issue_id":"mondodb-rsu","depends_on_id":"mondodb-t04","type":"blocks","created_at":"2026-01-04T11:39:41.163882-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-t04","title":"[REFACTOR] Element and array query operators","description":"Refactor:\n- Optimize array queries with CTE\n- Cache type mappings\n- Add specialized array indexes\n- Performance tuning for large arrays","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:18:06.348324-06:00","updated_at":"2026-01-04T11:58:26.708661-06:00","closed_at":"2026-01-04T11:58:26.708661-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-t04","depends_on_id":"mondodb-0rr","type":"blocks","created_at":"2026-01-04T11:22:18.574154-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-tg6","title":"Compat tests: replaceOne","description":"## Task\nCreate compatibility tests for replaceOne operation.\n\n## Location\n`test/compatibility/crud/replace.compat.test.ts`\n\n## Test Cases\n\n### replaceOne\n1. Replace existing document - returns UpdateResult\n2. Preserves _id on replace\n3. matchedCount when found\n4. modifiedCount when replaced\n5. No match - zero counts\n6. upsert:true creates document\n7. upsertedId on upsert\n8. Replacement cannot contain update operators (should error)\n9. Replace with empty document {}\n10. Replace removes fields not in replacement\n\n### Edge Cases\n1. Replace with same content (modifiedCount behavior)\n2. Replace nested document completely\n3. _id in replacement document (should be ignored or error?)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:40:47.98309-06:00","updated_at":"2026-01-04T13:40:47.98309-06:00","dependencies":[{"issue_id":"mondodb-tg6","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:47:48.378197-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-tg6","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:47:53.658564-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-tg6","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:47:58.947532-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-tuy","title":"[GREEN] capnweb RPC client","description":"Implement:\n- MongoClient wrapper over capnweb session\n- HTTP batch mode for efficiency\n- WebSocket mode for long-lived connections\n- Stub proxy for database/collection/cursor\n- using blocks for resource management","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:30:50.212945-06:00","updated_at":"2026-01-04T12:00:42.581627-06:00","closed_at":"2026-01-04T12:00:42.581627-06:00","close_reason":"Closed"}
{"id":"mondodb-ub7","title":"[GREEN] Cursor modifiers","description":"Implement:\n- limit() → SQL LIMIT clause\n- skip() → SQL OFFSET clause\n- sort() → SQL ORDER BY clause\n- project() → json_object field selection\n- Modifier state management\n- Query construction on iteration start","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:28:41.73939-06:00","updated_at":"2026-01-04T11:58:42.737811-06:00","closed_at":"2026-01-04T11:58:42.737811-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-ub7","depends_on_id":"mondodb-j84","type":"blocks","created_at":"2026-01-04T11:45:40.171044-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-w37","title":"Compat tests: findOneAndUpdate, findOneAndDelete, findOneAndReplace","description":"## Task\nCreate compatibility tests for findOneAnd* operations.\n\n## Location\n`test/compatibility/crud/find-and-modify.compat.test.ts`\n\n## Test Cases\n\n### findOneAndUpdate\n1. Returns original document (returnDocument:'before' default)\n2. Returns updated document (returnDocument:'after')\n3. Returns null when no match\n4. upsert:true creates and returns document\n5. Projection applies to returned document\n6. Sort determines which document when multiple match\n7. Update operators work correctly\n\n### findOneAndDelete\n1. Returns deleted document\n2. Returns null when no match\n3. Projection applies to returned document\n4. Sort determines which document to delete\n\n### findOneAndReplace\n1. Returns original document (returnDocument:'before')\n2. Returns new document (returnDocument:'after')\n3. Returns null when no match\n4. upsert:true with returnDocument:'after'\n5. Preserves _id on replace\n\n### Edge Cases\n1. Empty projection behavior\n2. Sort with ties\n3. Concurrent modification behavior","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:41:03.854575-06:00","updated_at":"2026-01-04T13:41:03.854575-06:00","dependencies":[{"issue_id":"mondodb-w37","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:48:04.248948-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-w37","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:48:09.54146-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-w37","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:48:14.826413-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-wic","title":"[REFACTOR] MongoClient connection","description":"Refactor:\n- Connection pooling support\n- Lazy connection initialization\n- Reconnection logic\n- Error handling improvements","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:24:31.165355-06:00","updated_at":"2026-01-04T12:01:28.033351-06:00","closed_at":"2026-01-04T12:01:28.033351-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-wic","depends_on_id":"mondodb-qow","type":"blocks","created_at":"2026-01-04T11:41:41.701268-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-xoo","title":"Compat tests: Field update operators","description":"## Task\nCreate compatibility tests for field update operators.\n\n## Location\n`test/compatibility/update-operators/field.compat.test.ts`\n\n## Operators\n- $set - Set field value\n- $unset - Remove field\n- $inc - Increment\n- $mul - Multiply\n- $min - Set if less than\n- $max - Set if greater than\n- $rename - Rename field\n- $currentDate - Set to current date\n\n## Test Cases\n\n### $set\n1. Set existing field\n2. Set new field\n3. Set nested field (creates intermediates)\n4. Set array element by index\n5. Set to null\n6. Set to empty object/array\n\n### $unset\n1. Remove existing field\n2. Remove non-existent field (no error)\n3. Remove nested field\n4. Remove array element (leaves null!)\n\n### $inc\n1. Increment existing number\n2. Increment non-existent field (creates with value)\n3. Negative increment (decrement)\n4. Increment non-numeric field (error?)\n5. Increment by float\n\n### $mul\n1. Multiply existing number\n2. Multiply non-existent field (creates as 0)\n3. Multiply by 0\n4. Multiply by negative\n\n### $min/$max\n1. Update if new value is less/greater\n2. No update if condition not met\n3. Create field if doesn't exist\n4. Compare with null\n\n### $rename\n1. Rename existing field\n2. Rename to nested path\n3. Rename non-existent field (no error)\n\n### $currentDate\n1. Set as Date type\n2. Set as timestamp type\n3. Create field if doesn't exist","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:43:01.0836-06:00","updated_at":"2026-01-04T13:43:01.0836-06:00","dependencies":[{"issue_id":"mondodb-xoo","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:49:49.480109-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-xoo","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:49:54.765724-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-xoo","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:50:00.049025-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-xyt","title":"[REFACTOR] Aggregation pipeline stages","description":"Refactor:\n- Stage optimization passes\n- Push down predicates\n- Combine adjacent stages\n- Memory-bounded aggregation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T11:38:12.412175-06:00","updated_at":"2026-01-04T12:03:16.720354-06:00","closed_at":"2026-01-04T12:03:16.720354-06:00","close_reason":"Closed"}
{"id":"mondodb-ypw","title":"[GREEN] ObjectId generation","description":"Implement:\n- 12-byte ObjectId: 4-byte timestamp + 5-byte random + 3-byte counter\n- Hex encoding to 24 characters\n- ObjectId.createFromHexString()\n- ObjectId.getTimestamp()\n- Comparison operators","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T11:15:42.197263-06:00","updated_at":"2026-01-04T11:54:25.868351-06:00","closed_at":"2026-01-04T11:54:25.868351-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-ypw","depends_on_id":"mondodb-83k","type":"blocks","created_at":"2026-01-04T11:16:39.852146-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-z2s","title":"[GREEN] Array update operators","description":"Implement:\n- translateArrayUpdate() for $push, $pull, $addToSet, $pop\n- Handle $each and $slice modifiers\n- Use json_group_array for complex operations\n- Subquery-based pull logic","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T11:23:43.575335-06:00","updated_at":"2026-01-04T11:59:48.989994-06:00","closed_at":"2026-01-04T11:59:48.989994-06:00","close_reason":"Closed","dependencies":[{"issue_id":"mondodb-z2s","depends_on_id":"mondodb-iua","type":"blocks","created_at":"2026-01-04T11:41:20.313133-06:00","created_by":"nathanclevenger"}]}
{"id":"mondodb-ziw","title":"Compat tests: deleteOne and deleteMany","description":"## Task\nCreate compatibility tests for delete operations.\n\n## Location\n`test/compatibility/crud/delete.compat.test.ts`\n\n## Test Cases\n\n### deleteOne\n1. Delete existing document - verify DeleteResult structure\n2. deletedCount is 1 when document deleted\n3. deletedCount is 0 when no match\n4. Filter matches multiple - only deletes first\n5. Delete by _id\n6. Delete with complex filter\n\n### deleteMany\n1. Deletes all matching documents\n2. deletedCount equals number deleted\n3. Empty filter {} deletes all documents\n4. No matches - deletedCount is 0\n\n### Edge Cases\n1. Delete from empty collection\n2. Delete with null filter value\n3. Delete with nested field filter\n\n### Return Value Structure\n```typescript\ninterface DeleteResult {\n  acknowledged: boolean\n  deletedCount: number\n}\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T13:40:33.094958-06:00","updated_at":"2026-01-04T13:40:33.094958-06:00","dependencies":[{"issue_id":"mondodb-ziw","depends_on_id":"mondodb-cny","type":"blocks","created_at":"2026-01-04T13:47:32.515876-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-ziw","depends_on_id":"mondodb-5c7","type":"blocks","created_at":"2026-01-04T13:47:37.805863-06:00","created_by":"nathanclevenger"},{"issue_id":"mondodb-ziw","depends_on_id":"mondodb-kv0","type":"blocks","created_at":"2026-01-04T13:47:43.092356-06:00","created_by":"nathanclevenger"}]}
